# zookeeper

## zookeeper由来

    雅虎开发人员试图开发一个通用的无单点问题的分布式协调框架，以便开发人员将精力集中在业务处理上；
    zookeeper名称由来：雅虎的很多项目都是以动物名称命名的，雅虎的工程师希望给这个项目也取一个动物的名字。时任研究院的首席科学家RaghuRamakrishnan开玩笑地说：“在这样下去，我们这儿就变成动物园了！”此话一出，大家纷纷表示就叫动物园管理员吧。雅虎的整个分布式系统就像一个动物园，而zookeeper正好要用来进行分布式环境的协调——于是，Zookeeper的名字也由此诞生了。

## zookeeper概览（zookeeper到底是什么）

    Zookeeper是一个开源的分布式协调框架服务
    Zookeeper的设计目的是将那些复杂且容易出错的分布式一致服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用
    Zookeeper是一个典型的分布式数据一致性解决方案，分布式应用程序可以基于Zookeeper实现诸如数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理、Master选举，分布式锁和分布式队列等功能
    常见的使用场景：担任服务生产者和消费者的注册中心

## zookeeper重要概念

    Zookeeper本身就是一个分布式程序（只要半数以上节点存活，Zookeeper就能正常服务）
    为了保证高可靠性，最好以集群的形态来部署Zookeeper，这样只要保证集群中大部分机器是可用的，那么Zookeeper本身仍然是可用
    Zookeeper将数据保存在内存中，这也保证了高吞吐量和低延迟
    Zookeeper是高性能的。在读多于写的情况下尤其高性能。因为“写”会导致所有服务器间同步状态（读多余写是协调系统的典型场景）
    Zookeeper有瞬时节点的概念。当创建节点的客户端一直保持活动，瞬时节点就会一直存在。而会话终结时，瞬时节点就会被删除（持久节点一旦创建会一直保存在zookeeper上，除非手动删除）

### 会话（session）

    Session是指Zookeeper服务端与客户端之间的会话。
    一个客户端连接指的是客户端和服务端之间的一个长的TCP连接。客户端能够通过“心跳”检测与服务器保持有效的会话，也能够像服务器Zookeeper发送请求并接受响应，同时还能通过该连接接收来自服务器的Watch事件通知
    session的sessionTimeout指标识客户端session的超时时间，当客户端连接断开时，只要在sessionTimeout时间内重新连上服务器，那么之前创建的会话仍然有效
    在为客户端创建会话之前，服务端首先会为每个客户端分配一个sessionId，sessionId能够保证全局唯一

### Znode

    数据模型中的数据单元
    zookeeper将所有数据存储在内存中，数据模型是一棵树，由斜线分割的路径，就是一个Znode，例如/foo/path1。Znode包含数据内容和一系列属性信息
    版本：对于每个Znode，Zookeeper会维护一个叫stat的数据结构，stat记录这个Znode的三个数据版本。分别是version，cversion aversion

### Watcher

    Zookeeper允许在指定的节点上注册Watcher,并且在一些特定事件触发的时候，Zookeeper会通知感兴趣的客户端，该机制是zookeeper实现分布式协调服务的重要特性